// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace WordDisplay.Pages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "/Users/machuynh/Desktop/WordDisplay/WordDisplay/_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "/Users/machuynh/Desktop/WordDisplay/WordDisplay/_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "/Users/machuynh/Desktop/WordDisplay/WordDisplay/_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "/Users/machuynh/Desktop/WordDisplay/WordDisplay/_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "/Users/machuynh/Desktop/WordDisplay/WordDisplay/_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "/Users/machuynh/Desktop/WordDisplay/WordDisplay/_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "/Users/machuynh/Desktop/WordDisplay/WordDisplay/_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "/Users/machuynh/Desktop/WordDisplay/WordDisplay/_Imports.razor"
using WordDisplay;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "/Users/machuynh/Desktop/WordDisplay/WordDisplay/_Imports.razor"
using WordDisplay.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "/Users/machuynh/Desktop/WordDisplay/WordDisplay/Pages/Index.razor"
using WordDisplay.Data;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "/Users/machuynh/Desktop/WordDisplay/WordDisplay/Pages/Index.razor"
using WordDisplay.Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "/Users/machuynh/Desktop/WordDisplay/WordDisplay/Pages/Index.razor"
using Newtonsoft.Json;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "/Users/machuynh/Desktop/WordDisplay/WordDisplay/Pages/Index.razor"
using System.Text;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "/Users/machuynh/Desktop/WordDisplay/WordDisplay/Pages/Index.razor"
using Microsoft.AspNetCore.SignalR.Client;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/")]
    public partial class Index : Microsoft.AspNetCore.Components.ComponentBase, IAsyncDisposable
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 68 "/Users/machuynh/Desktop/WordDisplay/WordDisplay/Pages/Index.razor"
 
    private HubConnection hubConnection;
    private string WordInput { get; set; }
    private List<string> words = new List<string>();
    private ServerState state { get; set; } = new ServerState();
    public string error { get; set; }

    /// <summary>
    /// Create our HubConnection to connect to our ServerStateHub via SignalR, and register a handler to listen for changes.
    /// </summary>
    /// <returns></returns>
    protected override async Task OnInitializedAsync()
    {
        hubConnection = new HubConnectionBuilder()
            .WithUrl(new Uri("http://localhost:5555/state"))
            .Build();
        hubConnection.On<bool, string, int>("StateChanged", (commandRunning, currentWordSelected, commandTimeRemainining) =>
        {
            state.CommandRunning = commandRunning;
            state.CurrentWordSelected = currentWordSelected;
            state.CommandTimeRemaining = commandTimeRemainining;
            Console.WriteLine("[StateChanged]: " + commandRunning + " " + currentWordSelected + " " + commandTimeRemainining);
            StateHasChanged();
        });
        await hubConnection.StartAsync();
    }

    /// <summary>
    /// Dispose the HubConnection.
    /// </summary>
    /// <returns></returns>
    public async ValueTask DisposeAsync()
    {
        await hubConnection.DisposeAsync();
    }

    /// <summary>
    /// Adds the value stored in WordInput into our list.
    /// </summary>
    private void Add()
    {
        if (string.IsNullOrWhiteSpace(WordInput))
            return;
        words.Add(WordInput);
        WordInput = null;
    }

    /// <summary>
    /// Removes the word from our list.
    /// </summary>
    /// <param name="word">The word to delete.</param>
    private void Remove(string word)
    {
        words.Remove(word);
    }

    /// <summary>
    /// Make a REST call to our API Server to invoke the StartCommand with our words.
    /// </summary>
    /// <returns></returns>
    public async Task Start()
    {
        if (words.Count <= 0)
        {
            error = "Please enter at least one word before starting!";
            return;
        }
        error = null;

        Payload p = new Payload { Words = this.words };

        var serialized = JsonConvert.SerializeObject(p, Formatting.Indented);
        var content = new StringContent(serialized, Encoding.UTF8, "application/json");
        var request = new HttpRequestMessage { RequestUri = new Uri("http://localhost:5555/api/word"), Method = HttpMethod.Post, Content = content };
        Console.WriteLine("Sending: " + serialized);


        var client = clientFactory.CreateClient();
        HttpResponseMessage res = await client.SendAsync(request);

        error = res.IsSuccessStatusCode ? null : "Something went wrong with start...";
    }

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IHttpClientFactory clientFactory { get; set; }
    }
}
#pragma warning restore 1591
